{% extends "base.html" %}
{% load static %}

<!-- Assistance from CI - Boutique Ado walkthrough -->
{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col">

        </div>
    </div>
</div>
{% endblock %}

<!-- Assistance from CI - Boutique Ado walkthrough -->
{% block content %}
    <div class="container">
        <!-- Page Header -->
        <div class="row">
            <div class="col-12 text-center">
                <h3 class="text-yellow heading-background-black">Basket</h3>
            </div>
        </div>

        <!-- Basket Items -->
        <div class="row">
            <div class="col-12">
                {% if basket_items %}
                    <table class="table table-striped table-dark">
                        <thead>
                            <tr>
                                <th scope="col">Whiskey Experience</th>
                                <th scope="col">Booking Date</th>
                                <th scope="col">Booking Time Slot</th>
                                <th scope="col">No. of Attendees</th>
                                <th scope="col">Price pp</th>
                                <th scope="col">Line item total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in basket_items %}
                            <tr>
                                <!-- Booking Name -->
                                <td>{{ item.experience.tour_name }}</td>

                                <!-- Booking Date -->
                                <td>
                                    <form class="form update-form" method="post" action="">
                                        {% csrf_token %}
                                        <div class="form-group visually-hidden">
                                            <label for="{{ item.form.booking_date.id_for_label }}">Number of Attendees:</label>
                                            {{ item.form.booking_date }}
                                        </div>
                                    </form>
                                </td>

                                <!-- Booking Time Slot -->
                                <td>
                                    <form class="form update-form" method="post" action="">
                                        {% csrf_token %}
                                        <div class="form-group visually-hidden">
                                            <label for="{{ item.form.booking_time_slot.id_for_label }}">Number of Attendees:</label>
                                            {{ item.form.booking_time_slot }}
                                        </div>
                                    </form>
                                </td>

                                <!-- Number of Attendees -->
                                <td>
                                    <form class="form update-form" method="post" action="">
                                        {% csrf_token %}
                                        <div class="form-group visually-hidden">
                                            <label for="{{ item.form.number_of_attendees.id_for_label }}">Number of Attendees:</label>
                                            {{ item.form.number_of_attendees }}
                                        </div>
                                    </form>
                                </td>

                                <!-- Experience price per person -->
                                <td>£{{ item.experience.tour_price }}</td>

                                <!-- Experience line item total -->
                                <td>£{{ item.experience.tour_price }}</td>
                            </tr>
                            {% endfor %}
                            
                            {% if discount %}
                            <tr>
                                <td colspan="6" class="pt-3 text-right pr-4">
                                    <strong>Total:</strong> £{{ total|floatformat:2 }} <br>
                                    <strong>Discount:</strong> £{{ discount|floatformat:2 }} <br>
                                    <strong>Basket Total:</strong> £{{ grand_total|floatformat:2 }}
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="pt-3 text-right">
                                    <strong>Basket Total:</strong> £{{ grand_total|floatformat:2 }}
                                </td>
                            </tr>
                            <p class="text-right"><strong>Spend £{{ discount_delta }} to get your 10% discount!</strong></p>
                            {% endif %}
                        </tbody>
                    </table>
                    <a href="{% url 'tours' %}" class="display-decoration-none btn bg-yellow text-black mt-3 mb-3">Continue Browsing Whiskey Experiences</a>
                    <a href="#" class="display-decoration-none btn bg-yellow text-black mt-3 mb-3">Book Now</a>
                {% else %}
                    <p class="text-center text-yellow">Your basket is currently empty</p>
                    <a class="display-decoration-none btn bg-yellow text-black mt-3 mb-3" href="{% url 'tours' %}">Back to Whiskey Experiences</a>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}